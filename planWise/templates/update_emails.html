<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Emails</title>
</head>
<body>
    <h1>Update Your Emails</h1>
    <form id="updateForm" method="post">
        {% csrf_token %}
        <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
            <h3>Update for {{ user.username }}</h3>
            {{ form.as_p }}
        </div>
        <button type="submit">Submit</button>
    </form>
    <div id="loadingMessage" style="display:none;">Please wait, validating your secondary password and saving emails...</div>
    <script>
        document.getElementById('updateForm').onsubmit = function(event) {
            event.preventDefault();
            var form = this;
            var data = new FormData(form);
            document.getElementById('loadingMessage').style.display = 'block';

            fetch(form.action, {
                method: 'POST',
                body: data,
                headers: {
                    'X-CSRFToken': data.get('csrfmiddlewaretoken')
                }
            }).then(response => response.json())
              .then(data => {
                  document.getElementById('loadingMessage').style.display = 'none';
                  if (data.status === 'success') {
                      window.location.href = "{% url 'check-users' %}";  // Ensure this URL is correct and matches the name in your urls.py
                  } else {
                      alert(data.message);  // Simple error handling
                  }
              });
        };
    </script>
</body>
</html>
